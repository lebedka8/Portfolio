<div style="border-radius: 15px; border: 3px solid indigo; padding: 15px;">
<b>Привет, Карина!</b>

Меня зовут Вадим Лепшин, и я буду проверять твой проект. Предлагаю общение на «ты», но если тебе комфортнее на «Вы», обязательно сообщи мне об этом. 

Моя основная цель — не указать на совершенные тобою ошибки, а поделиться своим опытом и помочь тебе стать аналитиком данных. Тобой проделана большая работа над проектом, давай сделаем его еще лучше. Ниже ты найдешь мои комментарии. Есть несколько правил:<br>
- <b>Пожалуйста, не перемещай, не изменяй и не удаляй комментарии.</b>
- У комментариев могут быть приписки <b>V2, V3</b> и т.д., которые соответствуют версии проверки. 
   
В тетрадке ты можешь встретить 3 вида моих комментариев:
    
<div class="alert alert-danger">
    <b>❌ Комментарий ревьюера:</b>
    
Комментарии такого цвета необходимо исправить, без их отработки проект не будет принят.
</div>
    
    
<div class="alert alert-warning">
    <b>⚠️ Комментарий ревьюера:</b>
    
На комментарии такого цвета нужно обязательно обратить внимание. Рекомендую учесть их при редактировании проекта и выполнении будущих заданий.
</div>
    
    
<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Так отмечены удачные решения и подходы, на которые стоит опираться в будущих проектах.
</div>
    
Предлагаю работать над проектом в диалоге: если ты хочешь ответить на мои комментарии — пиши об этом. Мне будет легче отследить изменения, если ты выделишь свои комментарии вот так:

<div class="alert alert-info">
<b> Комментарий студента</b>

Здравствуй, Вадим!Благодарю за внимание к моей работе.
</div>


Всё это поможет выполнить повторную проверку твоего проекта оперативнее.
</div>

# Анализ А/В теста крупного интернет-магазина

***
*В нашем распоряжении данные крупного инернет-магазина. А также список гипотез для увеличения выручки, подготовленных совместно с отделом маркетинга.*

***Цель исследования*** *- приоритизировать гипотезы, запуститьA/B-тест и проанализировать результаты.*

***Ход исследования:***

***1.*** *Приоритизация гипотез методами ICE и RICE, сравние результатов показателей*

***2.*** *Подготовка данных*

***3.*** *Анализ А/Б теста*

***3.*** *Вывод*

***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Введение принято!
</div>

## Приоритизация гипотез


```python
import pandas as pd                                                                            # импортируем библиотеку pandas
import matplotlib.pyplot as plt                                                            # импортируем библиотеку matplotlib
import datetime as dt                                                                 # импортируем модуль для работы с датами
import numpy as np                                                                              # импортируем библиотеку numpy
from scipy import stats as st                                                                  # импортируем библиотеку scipy
import scipy.stats as stats
```


```python
try:                                                                                                      # открываем датафрейм
    hypotheses = pd.read_csv('/datasets/hypothesis.csv')                                    
except: 
    hypotheses = pd.read_csv('https://code.s3.yandex.net/datasets/hypothesis.csv')
pd.set_option('display.max_colwidth',None)                                #приведем к виду отображения всех столбцоф датафрейма
hypotheses.columns = map(str.lower, hypotheses.columns)
hypotheses.head()                                                                          # выведем первые пять строк таблицы
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hypothesis</th>
      <th>reach</th>
      <th>impact</th>
      <th>confidence</th>
      <th>efforts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Добавить два новых канала привлечения трафика, что позволит привлекать на 30% больше пользователей</td>
      <td>3</td>
      <td>10</td>
      <td>8</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Запустить собственную службу доставки, что сократит срок доставки заказов</td>
      <td>2</td>
      <td>5</td>
      <td>4</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Добавить блоки рекомендаций товаров на сайт интернет магазина, чтобы повысить конверсию и средний чек заказа</td>
      <td>8</td>
      <td>3</td>
      <td>7</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Изменить структура категорий, что увеличит конверсию, т.к. пользователи быстрее найдут нужный товар</td>
      <td>8</td>
      <td>3</td>
      <td>3</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Изменить цвет фона главной страницы, чтобы увеличить вовлеченность пользователей</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Молодец что вывела столбец с гипотезами целиком!
</div>


```python
hypotheses['ICE'] = round(((hypotheses['impact']*hypotheses['confidence'])/ hypotheses['efforts']),1)   # рассчитываем парамерт ICE 
hypotheses[['hypothesis', 'ICE']].sort_values(by='ICE', ascending = False)                   # отсортируем параметр по убыванию
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hypothesis</th>
      <th>ICE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>Запустить акцию, дающую скидку на товар в день рождения</td>
      <td>16.2</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Добавить два новых канала привлечения трафика, что позволит привлекать на 30% больше пользователей</td>
      <td>13.3</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Добавить форму подписки на все основные страницы, чтобы собрать базу клиентов для email-рассылок</td>
      <td>11.2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Показать на главной странице баннеры с актуальными акциями и распродажами, чтобы увеличить конверсию</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Добавить блоки рекомендаций товаров на сайт интернет магазина, чтобы повысить конверсию и средний чек заказа</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Запустить собственную службу доставки, что сократит срок доставки заказов</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Добавить страницу отзывов клиентов о магазине, что позволит увеличить количество заказов</td>
      <td>1.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Изменить структура категорий, что увеличит конверсию, т.к. пользователи быстрее найдут нужный товар</td>
      <td>1.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Изменить цвет фона главной страницы, чтобы увеличить вовлеченность пользователей</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>



<div class="alert alert-warning">
    <b>⚠️ Комментарий ревьюера:</b>
    
Рекомендую округлить результаты ICE до 1 знака после запятой.
</div>

<div class="alert alert-info">
Исправила
</div>

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

👍
</div>


```python
#рассчитываем парамерт RICE для определения приоритетности гипотез
hypotheses['RICE'] = (hypotheses['impact']*hypotheses['confidence']*hypotheses['reach'])/ hypotheses['efforts']
hypotheses[['hypothesis', 'RICE']].sort_values(by='RICE', ascending = False)                # отсортируем параметр по убыванию
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hypothesis</th>
      <th>RICE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>Добавить форму подписки на все основные страницы, чтобы собрать базу клиентов для email-рассылок</td>
      <td>112.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Добавить блоки рекомендаций товаров на сайт интернет магазина, чтобы повысить конверсию и средний чек заказа</td>
      <td>56.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Добавить два новых канала привлечения трафика, что позволит привлекать на 30% больше пользователей</td>
      <td>40.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Показать на главной странице баннеры с актуальными акциями и распродажами, чтобы увеличить конверсию</td>
      <td>40.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Запустить акцию, дающую скидку на товар в день рождения</td>
      <td>16.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Изменить структура категорий, что увеличит конверсию, т.к. пользователи быстрее найдут нужный товар</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Запустить собственную службу доставки, что сократит срок доставки заказов</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Добавить страницу отзывов клиентов о магазине, что позволит увеличить количество заказов</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Изменить цвет фона главной страницы, чтобы увеличить вовлеченность пользователей</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
#выведем одновременно результаты и RICE и ICE для удобства сравнения
hypotheses[['hypothesis', 'RICE', 'ICE']].sort_values(by='RICE', ascending = False)      
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hypothesis</th>
      <th>RICE</th>
      <th>ICE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>Добавить форму подписки на все основные страницы, чтобы собрать базу клиентов для email-рассылок</td>
      <td>112.0</td>
      <td>11.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Добавить блоки рекомендаций товаров на сайт интернет магазина, чтобы повысить конверсию и средний чек заказа</td>
      <td>56.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Добавить два новых канала привлечения трафика, что позволит привлекать на 30% больше пользователей</td>
      <td>40.0</td>
      <td>13.3</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Показать на главной странице баннеры с актуальными акциями и распродажами, чтобы увеличить конверсию</td>
      <td>40.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Запустить акцию, дающую скидку на товар в день рождения</td>
      <td>16.2</td>
      <td>16.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Изменить структура категорий, что увеличит конверсию, т.к. пользователи быстрее найдут нужный товар</td>
      <td>9.0</td>
      <td>1.1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Запустить собственную службу доставки, что сократит срок доставки заказов</td>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Добавить страницу отзывов клиентов о магазине, что позволит увеличить количество заказов</td>
      <td>4.0</td>
      <td>1.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Изменить цвет фона главной страницы, чтобы увеличить вовлеченность пользователей</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>



<div class="alert alert-warning">
  <b>⚠️ Комментарий ревьюера:</b>
    
Давай выведем здесь одновременно результаты и RICE и ICE для удобства сравнения.
  </div>

<div class="alert alert-info">
Добавила
</div>

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

Супер
</div>

***
***Вывод:*** *При применении метода ICE на первых трех местах оказались гипотезы с индексами 8, 0 и 7 соответственно. После применения метода приоретизации RICE на первых трех местах оказались гипотезы с индексами 7, 2 и 0. Мы наблюдаем смену приоритетных гипотез, так как во втором методе дополнительно учитывается параметр reach — охват пользователей, на которых повлияет изменение.*
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Все верно, дело в охвате!
</div>

## Получение  и предобработка данных


```python
# импортируем данные 
try:
    orders = pd.read_csv('/datasets/orders.csv')
except:
    orders = pd.read_csv('https://code.s3.yandex.net/datasets/orders.csv')

orders.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>transactionId</th>
      <th>visitorId</th>
      <th>date</th>
      <th>revenue</th>
      <th>group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3667963787</td>
      <td>3312258926</td>
      <td>2019-08-15</td>
      <td>1650</td>
      <td>B</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2804400009</td>
      <td>3642806036</td>
      <td>2019-08-15</td>
      <td>730</td>
      <td>B</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2961555356</td>
      <td>4069496402</td>
      <td>2019-08-15</td>
      <td>400</td>
      <td>A</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3797467345</td>
      <td>1196621759</td>
      <td>2019-08-15</td>
      <td>9759</td>
      <td>B</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2282983706</td>
      <td>2322279887</td>
      <td>2019-08-15</td>
      <td>2308</td>
      <td>B</td>
    </tr>
  </tbody>
</table>
</div>




```python
try:
    visitors = pd.read_csv('/datasets/visitors.csv')
except:
    visitors = pd.read_csv('https://code.s3.yandex.net/datasets/visitors.csv')

visitors.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>group</th>
      <th>visitors</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-08-01</td>
      <td>A</td>
      <td>719</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-08-02</td>
      <td>A</td>
      <td>619</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-08-03</td>
      <td>A</td>
      <td>507</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-08-04</td>
      <td>A</td>
      <td>717</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-08-05</td>
      <td>A</td>
      <td>756</td>
    </tr>
  </tbody>
</table>
</div>




```python
# проверим типы данных в колонках
df = [orders,visitors]
for i in df:
    print(i.info())
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 1197 entries, 0 to 1196
    Data columns (total 5 columns):
     #   Column         Non-Null Count  Dtype 
    ---  ------         --------------  ----- 
     0   transactionId  1197 non-null   int64 
     1   visitorId      1197 non-null   int64 
     2   date           1197 non-null   object
     3   revenue        1197 non-null   int64 
     4   group          1197 non-null   object
    dtypes: int64(3), object(2)
    memory usage: 46.9+ KB
    None
    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 62 entries, 0 to 61
    Data columns (total 3 columns):
     #   Column    Non-Null Count  Dtype 
    ---  ------    --------------  ----- 
     0   date      62 non-null     object
     1   group     62 non-null     object
     2   visitors  62 non-null     int64 
    dtypes: int64(1), object(2)
    memory usage: 1.6+ KB
    None



```python
# приведем данные с датой к нужному типу
orders['date'] = orders['date'].map(lambda x: dt.datetime.strptime(x, '%Y-%m-%d'))
visitors['date'] = visitors['date'].map(lambda x: dt.datetime.strptime(x, '%Y-%m-%d'))
```


```python
#приведем назания столбцов к нижнему регистру
orders.columns = orders.columns.str.lower()
```


```python
# приведем названия колонок к формату snake_case
orders = orders.rename(columns={'transactionid':'transaction_id','visitorid':'visitor_id'})
```


```python
# проверим пропуски в таблицах
for i in df:
    print(i.isna().sum())   
```

    transactionid    0
    visitorid        0
    date             0
    revenue          0
    group            0
    dtype: int64
    date        0
    group       0
    visitors    0
    dtype: int64



```python
# проверим полные дубликаты в таблицах
for i in df:
    print (i.duplicated().sum())
```

    0
    0



```python
# проверим количество посетителей в каждой группе 
group_a = visitors.query('group == "A"')['visitors'].sum() 
group_b = visitors.query('group == "B"')['visitors'].sum() 
 
(group_b/(group_a+group_b))*100 - (group_a/(group_a+group_b))*100
```




    0.4780622543291173



Отличие между группами в пользователях менее 1%. Группы можно считать равноценными. Убедимся, что в каждую группу попали уникальные пользователи.


```python
# найдем уникальные id пользователей в каждой группе
unique_id_list_A = orders.query('group == "A"')['visitor_id'].unique().tolist()
unique_id_list_B = orders.query('group == "B"')['visitor_id'].unique().tolist()
unique_id_dublicated = []

# проверим совпадения пользователей в группах
for x in unique_id_list_A:
    if x in unique_id_list_B:
        unique_id_dublicated.append(x)
print('Количество пользователей, которые попали в обе группы', len(unique_id_dublicated))
```

    Количество пользователей, которые попали в обе группы 58



```python
# Посчитаем долю этих пользователей от общего числа тестируемых
len(unique_id_dublicated)/len(orders['visitor_id'].unique())*100
```




    5.625606207565471



Некоторые покупатели попали сразу в обе группы. Их количество незначительно (5,6%), можно оставить этих покупателей в тесте, так как если мы удалим их, это скажется на дальнейших расчетах. Тем более, что удалить этих пользоватей из второй таблицы мы не сможем, нет возможности найти их id.

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Все абсолютно верно!
</div>


```python
# выясним дату начала теста
visitors['date'].min()
```




    Timestamp('2019-08-01 00:00:00')




```python
# выясним дату конца теста
visitors['date'].max()
```




    Timestamp('2019-08-31 00:00:00')




```python
# посчитаем сколько дней длился тест
print(visitors['date'].max() - visitors['date'].min())
```

    30 days 00:00:00



```python
# выведем на экран первые пять строк таблиц
orders.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>transaction_id</th>
      <th>visitor_id</th>
      <th>date</th>
      <th>revenue</th>
      <th>group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3667963787</td>
      <td>3312258926</td>
      <td>2019-08-15</td>
      <td>1650</td>
      <td>B</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2804400009</td>
      <td>3642806036</td>
      <td>2019-08-15</td>
      <td>730</td>
      <td>B</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2961555356</td>
      <td>4069496402</td>
      <td>2019-08-15</td>
      <td>400</td>
      <td>A</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3797467345</td>
      <td>1196621759</td>
      <td>2019-08-15</td>
      <td>9759</td>
      <td>B</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2282983706</td>
      <td>2322279887</td>
      <td>2019-08-15</td>
      <td>2308</td>
      <td>B</td>
    </tr>
  </tbody>
</table>
</div>




```python
visitors.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>group</th>
      <th>visitors</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-08-01</td>
      <td>A</td>
      <td>719</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-08-02</td>
      <td>A</td>
      <td>619</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-08-03</td>
      <td>A</td>
      <td>507</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-08-04</td>
      <td>A</td>
      <td>717</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-08-05</td>
      <td>A</td>
      <td>756</td>
    </tr>
  </tbody>
</table>
</div>



 ***
***Вывод:*** *В нашем распоряжении данные с результатами проведенных А/В тестов крупного интернет - магазина.* 

***Таблица orders:***
* transaction_id — идентификатор заказа;
* visitor_id — идентификатор пользователя, совершившего заказ;
* date — дата, когда был совершён заказ;
* revenue — выручка заказа;
* group — группа A/B-теста, в которую попал заказ.

***Таблица visitors:***

* date — дата;
* group — группа A/B-теста;
* visitors — количество пользователей в указанную дату в указанной группе A/B-теста

***По итогу предобработки данных:***
* Привели названия столбцов к нужному виду.
* Преобразовали данных о датах.
* Проверили данные на дубликаты и пропуски.
* Выснили, что тест проходил 30 дней. С 1 по 31 августа 2019 года.
* Посчитали количество пользователей в группах. Различия составляют не более, чем 1%.
* Обнаружили пользователей, которые попали в обе группы, их количество составляет 5,6% от общего числа уникальных пользователей. Решили оставить исходные данные, так как не сможем удалить этих пользователей из двух датафреймов. 
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Предобработка принята!!
</div>

##  Анализ A/B-теста

### График кумулятивной выручки по группам

Чтобы отслеживать изменения результатов эксперимента на каждый день тестирования, составим датафрейм с куммулятивными данными. 


```python
# создаем массив уникальных пар значений дат и групп теста
datesGroups  = orders[['date', 'group']].drop_duplicates()

# получаем агрегированные кумулятивные по дням данные о заказах
ordersAggregated = datesGroups.apply(lambda x: orders[np.logical_and(orders['date'] <= x['date'],\
                                                                     orders['group'] == x['group'])]\
                                     .agg({'date' : 'max', 'group' : 'max', 'transaction_id' : 'nunique', \
                                           'visitor_id' : 'nunique', 'revenue' : 'sum'}), axis=1)\
                                     .sort_values(by=['date','group'])

#получим агрегированные кумулятивные по дням данные о посетителях интернет-магазина:
visitorsAggregated = datesGroups.apply(lambda x: visitors[np.logical_and(visitors['date'] <= x['date'],\
                                                                         visitors['group'] == x['group'])]\
                                       .agg({'date' : 'max', 'group' : 'max', 'visitors' : 'sum'}), axis=1)\
                                       .sort_values(by=['date','group'])

# объединяем кумулятивные данные в одной таблице и присваиваем ее столбцам понятные названия
cumulativeData = ordersAggregated.merge(visitorsAggregated, left_on=['date', 'group'], right_on=['date', 'group'])
cumulativeData.columns = ['date', 'group', 'orders', 'buyers', 'revenue', 'visitors']

cumulativeData.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>group</th>
      <th>orders</th>
      <th>buyers</th>
      <th>revenue</th>
      <th>visitors</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-08-01</td>
      <td>A</td>
      <td>24</td>
      <td>20</td>
      <td>148579</td>
      <td>719</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-08-01</td>
      <td>B</td>
      <td>21</td>
      <td>20</td>
      <td>101217</td>
      <td>713</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-08-02</td>
      <td>A</td>
      <td>44</td>
      <td>38</td>
      <td>242401</td>
      <td>1338</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-08-02</td>
      <td>B</td>
      <td>45</td>
      <td>43</td>
      <td>266748</td>
      <td>1294</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-08-03</td>
      <td>A</td>
      <td>68</td>
      <td>62</td>
      <td>354874</td>
      <td>1845</td>
    </tr>
  </tbody>
</table>
</div>



Перед нами таблица со столбцами:
* date — дата;
* group — группа A/B-теста (A или B);
* orders — кумулятивное количество заказов на указанную дату в указанной группе;
* buyers — кумулятивное количество пользователей, совершивших хотя бы один заказ, на указанную дату в указанной группе;
* revenue — кумулятивная выручка на указанную дату в указанной группе (средний чек);
* visitors — кумулятивное количество посетителей интернет-магазина на указанную дату в определённой группе.


```python
# датафрейм с кумулятивным количеством заказов и кумулятивной выручкой по дням в группе А
cumulativeRevenueA = cumulativeData[cumulativeData['group']=='A'][['date','revenue', 'orders']]
cumulativeRevenueA.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>revenue</th>
      <th>orders</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-08-01</td>
      <td>148579</td>
      <td>24</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-08-02</td>
      <td>242401</td>
      <td>44</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-08-03</td>
      <td>354874</td>
      <td>68</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2019-08-04</td>
      <td>425699</td>
      <td>84</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2019-08-05</td>
      <td>549917</td>
      <td>109</td>
    </tr>
  </tbody>
</table>
</div>




```python
# датафрейм с кумулятивным количеством заказов и кумулятивной выручкой по дням в группе B
cumulativeRevenueB = cumulativeData[cumulativeData['group']=='B'][['date','revenue', 'orders']]
cumulativeRevenueB.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>revenue</th>
      <th>orders</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2019-08-01</td>
      <td>101217</td>
      <td>21</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-08-02</td>
      <td>266748</td>
      <td>45</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2019-08-03</td>
      <td>380996</td>
      <td>61</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2019-08-04</td>
      <td>489567</td>
      <td>78</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2019-08-05</td>
      <td>581995</td>
      <td>101</td>
    </tr>
  </tbody>
</table>
</div>




```python
plt.rcParams ['figure.figsize'] = [12, 6]

# Строим график выручки группы А
plt.plot(cumulativeRevenueA['date'], cumulativeRevenueA['revenue'], label='A',color = '#ff8d1a', linewidth= 3)

# Строим график выручки группы B
plt.plot(cumulativeRevenueB['date'], cumulativeRevenueB['revenue'], label='B', linewidth= 3, color='#1a8cff')


plt.legend()
plt.ticklabel_format(style='plain', axis='y')
plt.title('График кумулятивной выручки по группам')
plt.xlabel('Дата')
plt.ylabel('Выручка')
plt.grid()
plt.show()
```


    
![png](output_48_0.png)
    


<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

График построен и оформлен корректно!
</div>

***
***Вывод:*** *Выручка почти равномерно увеличивается в течение всего теста. Однако график группы В в одной точке резко начинает расти, и все остальное время значительно превышае группу А. Это может сигнализировать о всплесках числа заказов, либо о появлении очень дорогих заказов в выборке.*
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Вывод принят!
</div>

### График кумулятивного среднего чека по группам


```python
# Построим график среднего чека по группам

plt.plot(cumulativeRevenueA['date'], cumulativeRevenueA['revenue']/cumulativeRevenueA['orders'],
         label='A',color = '#ff8d1a', linewidth= 3)

plt.plot(cumulativeRevenueB['date'], cumulativeRevenueB['revenue']/cumulativeRevenueB['orders'],
         label='B', linewidth= 3, color='#1a8cff')

plt.legend()
plt.title('График кумулятивного среднего чека по группам')
plt.xlabel('Дата')
plt.ylabel('Средний чек')
plt.grid()
plt.show()
```


    
![png](output_53_0.png)
    


***
***Вывод:*** *Средний чек в группе В и здесь имеет резкий скачок и в дальнейшим показатели намного превышают цифры группы А. Возможно попали крупные заказы, что существенно искажает выводы. Требуется дополнительный анализ выбросов.*
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Принято! Обрати внимание, средний чек В еще не стабилизировался.
</div>

### График относительного изменения кумулятивного среднего чека группы B к группе A


```python
# собираем данные в одном датафрейме
mergedCumulativeRevenue = cumulativeRevenueA.merge(cumulativeRevenueB, 
                                                   left_on='date', right_on='date', how='left', suffixes=['A', 'B'])
mergedCumulativeRevenue.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>revenueA</th>
      <th>ordersA</th>
      <th>revenueB</th>
      <th>ordersB</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-08-01</td>
      <td>148579</td>
      <td>24</td>
      <td>101217</td>
      <td>21</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-08-02</td>
      <td>242401</td>
      <td>44</td>
      <td>266748</td>
      <td>45</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-08-03</td>
      <td>354874</td>
      <td>68</td>
      <td>380996</td>
      <td>61</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-08-04</td>
      <td>425699</td>
      <td>84</td>
      <td>489567</td>
      <td>78</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-08-05</td>
      <td>549917</td>
      <td>109</td>
      <td>581995</td>
      <td>101</td>
    </tr>
  </tbody>
</table>
</div>




```python
# cтроим отношение средних чеков
plt.plot(mergedCumulativeRevenue['date'],(mergedCumulativeRevenue['revenueB']/mergedCumulativeRevenue['ordersB'])\
         /(mergedCumulativeRevenue['revenueA']/mergedCumulativeRevenue['ordersA'])-1,\
        color = '#1a8cff', linewidth= 3)

# добавляем ось X
plt.axhline(y=0, color='black', linestyle='--')
plt.axhline(y=0.26, color='grey', linestyle='--')
plt.title('График относительного изменения кумулятивного среднего чека группы B к группе A')
plt.xlabel('Дата')
plt.ylabel('Средний чек')

plt.show()
```


    
![png](output_58_0.png)
    


***
***Вывод:*** *На графики ярко видно, что показатели отношений среднего чека  групп резко менялись несколько раз. Видимо как раз в эти даты и были сделаны аномально крупные покупки в группе В. Необходимо найти выбросы в данных.*
****

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Согласен!
</div>

### График график кумулятивного среднего количества заказов на посетителя по группам


```python
# считаем кумулятивное среднее количество заказов на посетителя
cumulativeData['ratio'] = cumulativeData['orders']/cumulativeData['visitors']
cumulativeData.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>group</th>
      <th>orders</th>
      <th>buyers</th>
      <th>revenue</th>
      <th>visitors</th>
      <th>ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-08-01</td>
      <td>A</td>
      <td>24</td>
      <td>20</td>
      <td>148579</td>
      <td>719</td>
      <td>0.033380</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-08-01</td>
      <td>B</td>
      <td>21</td>
      <td>20</td>
      <td>101217</td>
      <td>713</td>
      <td>0.029453</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-08-02</td>
      <td>A</td>
      <td>44</td>
      <td>38</td>
      <td>242401</td>
      <td>1338</td>
      <td>0.032885</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-08-02</td>
      <td>B</td>
      <td>45</td>
      <td>43</td>
      <td>266748</td>
      <td>1294</td>
      <td>0.034776</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-08-03</td>
      <td>A</td>
      <td>68</td>
      <td>62</td>
      <td>354874</td>
      <td>1845</td>
      <td>0.036856</td>
    </tr>
  </tbody>
</table>
</div>




```python
# отделяем данные по группе A
cumulativeDataA = cumulativeData[cumulativeData['group']=='A']

# отделяем данные по группе B
cumulativeDataB = cumulativeData[cumulativeData['group']=='B']

# строим графики
plt.plot(cumulativeDataA['date'], cumulativeDataA['ratio'], label='A', color = '#ff8d1a', linewidth= 3)
plt.plot(cumulativeDataB['date'], cumulativeDataB['ratio'], label='B', linewidth= 3, color='#1a8cff')

plt.legend()
plt.grid()
plt.title('График график кумулятивного среднего количества заказов на посетителя по группам')
plt.xlabel('Дата')
plt.ylabel('Количество заказов')

plt.show()
#plt.axis(["2019-08-01", "2019-08-31", 0, 0.040]) - не могу дабавить параметр, пожалуйста, подскажите как это сделать
# появляется еще одна пустая рамка для графика.
```


    
![png](output_63_0.png)
    


***
***Вывод:*** *В начале графика количество заказов на посетителя групп меняли лидерские позиции, но после 5 августа показатели группы В продолжали расти, а показатели группы А - падать. В итоге количество заказов группы А оказалось в пределах 0,029-0,030% . Количетво заказов группы В закрепилась примерно на уровне показателей 0,033-0,034%.*
***

<div class="alert alert-danger">
    <b>❌ Комментарий ревьюера:</b>
    
Вычислить конверсию в этом проекте нет возможности т.к. у нас нет данных об уникальных посещениях (в таблице visitors нет id посетителей). Поэтому в задании говорится о количестве заказов, а не о конверсии. Давай заменим формулировку "конверсия" на "количество заказов" в графиках и выводах в этом задании и в остальном проекте. 
</div>

<div class="alert alert-info">
Замениала
</div>

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

Принято!
</div>

### График относительного изменения кумулятивного среднего количества заказов на посетителя группы B к группе A


```python
mergedCumulativeratios = cumulativeDataA[['date','ratio']].merge(cumulativeDataB[['date','ratio']],
                                                                           left_on='date', 
                                                                           right_on='date', how='left', suffixes=['A', 'B'])
mergedCumulativeratios.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>ratioA</th>
      <th>ratioB</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-08-01</td>
      <td>0.033380</td>
      <td>0.029453</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-08-02</td>
      <td>0.032885</td>
      <td>0.034776</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-08-03</td>
      <td>0.036856</td>
      <td>0.033833</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-08-04</td>
      <td>0.032787</td>
      <td>0.030315</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-08-05</td>
      <td>0.032851</td>
      <td>0.030793</td>
    </tr>
  </tbody>
</table>
</div>




```python
plt.plot(mergedCumulativeratios['date'], 
         mergedCumulativeratios['ratioB']/mergedCumulativeratios['ratioA']-1,
        linewidth= 3, color='#1a8cff')


plt.axhline(y=0, color='black', linestyle='--')
plt.axhline(y=0.14, color='grey', linestyle='--') 
plt.title('График относительного изменения кумулятивного среднего количества заказов на посетителя группы B к группе A')
plt.xlabel('Дата')
plt.ylabel('Cреднеее количество заказов на посетителя')
plt.show()
```


    
![png](output_70_0.png)
    


***
***Вывод:*** *Среднее количество заказов в начале теста было не стабильно  в группах относительно друг друга.После 5 августа показатель в группе В резко вырос, а в группе А упал. График отношений после этой даты показывает результаты в пользу группы В и к концу теста достигает уровня 0,15 %.* 
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

Теперь все корректно!
</div>

###  Точечный график количества заказов по пользователям


```python
# подсчитаем количество заказов по пользователям и посмотрим на результат

ordersByUsers = (
    orders.groupby('visitor_id', as_index=False)
    .agg({'transaction_id': 'nunique'})
)

ordersByUsers.columns = ['user_id', 'orders']

ordersByUsers.sort_values(by='orders', ascending=False).head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>orders</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1023</th>
      <td>4256040402</td>
      <td>11</td>
    </tr>
    <tr>
      <th>591</th>
      <td>2458001652</td>
      <td>11</td>
    </tr>
    <tr>
      <th>569</th>
      <td>2378935119</td>
      <td>9</td>
    </tr>
    <tr>
      <th>487</th>
      <td>2038680547</td>
      <td>8</td>
    </tr>
    <tr>
      <th>44</th>
      <td>199603092</td>
      <td>5</td>
    </tr>
    <tr>
      <th>744</th>
      <td>3062433592</td>
      <td>5</td>
    </tr>
    <tr>
      <th>55</th>
      <td>237748145</td>
      <td>5</td>
    </tr>
    <tr>
      <th>917</th>
      <td>3803269165</td>
      <td>5</td>
    </tr>
    <tr>
      <th>299</th>
      <td>1230306981</td>
      <td>5</td>
    </tr>
    <tr>
      <th>897</th>
      <td>3717692402</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>




```python
# построим точечную диаграмму числа заказов на одного пользователя

x_values = pd.Series(range(0,len(ordersByUsers)))
plt.scatter(x_values, ordersByUsers['orders'], alpha = 0.5, color='#1a8cff') 

plt.title('Точечный график количества заказов по пользователям')
plt.xlabel('пользователи')
plt.ylabel('Заказы')
plt.grid()
plt.show()
```


    
![png](output_75_0.png)
    


***
***Вывод:*** *По графику видно, что чаще всего покупатели совершают от 1-2 заказа. Но также мы нашли пользователей, которые делаю от 5 до 11 покупок. Доля их неясна, продолжим исследование, чтобы точно выяснить каков их процент.*
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

График построен верно, вывод логичен.
</div>

### Перцентили количества заказов на пользователя


```python
# посчитаем 95-й и 99-й перцентили стоимости заказов
print(np.percentile(ordersByUsers['orders'], [95, 99]))
```

    [2. 4.]


***
***Вывод:*** *Не более 5% посетителей интренет-магазина делали более двух заказов и не более 1% посетителей более 4-х заказов. Выберем 4 заказа границей для определения аномальных пользователей.*
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Принято!
</div>

### Точечный график стоимостей заказов 


```python
# Посмотрим на ТОП-10 максимальных по стоимости заказов
orders.sort_values(by='revenue', ascending=False).head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>transaction_id</th>
      <th>visitor_id</th>
      <th>date</th>
      <th>revenue</th>
      <th>group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>425</th>
      <td>590470918</td>
      <td>1920142716</td>
      <td>2019-08-19</td>
      <td>1294500</td>
      <td>B</td>
    </tr>
    <tr>
      <th>1196</th>
      <td>3936777065</td>
      <td>2108080724</td>
      <td>2019-08-15</td>
      <td>202740</td>
      <td>B</td>
    </tr>
    <tr>
      <th>858</th>
      <td>192721366</td>
      <td>1316129916</td>
      <td>2019-08-27</td>
      <td>93940</td>
      <td>A</td>
    </tr>
    <tr>
      <th>1136</th>
      <td>666610489</td>
      <td>1307669133</td>
      <td>2019-08-13</td>
      <td>92550</td>
      <td>A</td>
    </tr>
    <tr>
      <th>744</th>
      <td>3668308183</td>
      <td>888512513</td>
      <td>2019-08-27</td>
      <td>86620</td>
      <td>B</td>
    </tr>
    <tr>
      <th>682</th>
      <td>1216533772</td>
      <td>4266935830</td>
      <td>2019-08-29</td>
      <td>78990</td>
      <td>B</td>
    </tr>
    <tr>
      <th>662</th>
      <td>1811671147</td>
      <td>4266935830</td>
      <td>2019-08-29</td>
      <td>78990</td>
      <td>A</td>
    </tr>
    <tr>
      <th>743</th>
      <td>3603576309</td>
      <td>4133034833</td>
      <td>2019-08-09</td>
      <td>67990</td>
      <td>A</td>
    </tr>
    <tr>
      <th>1103</th>
      <td>1348774318</td>
      <td>1164614297</td>
      <td>2019-08-12</td>
      <td>66350</td>
      <td>A</td>
    </tr>
    <tr>
      <th>1099</th>
      <td>316924019</td>
      <td>148427295</td>
      <td>2019-08-12</td>
      <td>65710</td>
      <td>A</td>
    </tr>
  </tbody>
</table>
</div>




```python
# посмотрим распределение стоимости заказов
x_values = pd.Series(range(0,len(orders['revenue'])))
plt.scatter(x_values, orders['revenue'], alpha = 0.5, color='#1a8cff') 

plt.title('Точечный график стоимостей заказов')
plt.xlabel('Пользователи')
plt.ylabel('Стоимость заказов')
plt.ticklabel_format(style='plain', axis='y')
plt.grid()
plt.show()
```


    
![png](output_84_0.png)
    



```python
# посмотрим распределение стоимости заказов без выброса
x_values = pd.Series(range(0,len(orders['revenue'])))
plt.scatter(x_values, orders['revenue'], alpha = 0.5, color='#1a8cff') 

plt.title('Точечный график стоимостей заказов')
plt.xlabel('Пользователи')
plt.ylabel('Стоимость заказов')
plt.ticklabel_format(style='plain', axis='y')
plt.ylim(0, 120000)
plt.grid()
plt.show()
```


    
![png](output_85_0.png)
    


***
***Вывод:*** *График нам показывает, что чаще всего пользователи делают покупки суммой до 15000 рублей. Но невозможно не обратить внимания на покупателя с  ID 1920142716, который совершил покупку на 1294500 рублей. Большая часть заказов совершается стоимостью до 20000 рублей. Есть небольшая часть заказов от 20000 до 60000 рублей. Нужно точно выяснить какова их доля.*
***

<div class="alert alert-danger">
    <b>❌ Комментарий ревьюера:</b>
    
Из-за двух выбросов график стал неинформативным. Давай сделаем еще один график без выбросов.
</div>

<div class="alert alert-info">
График добавила, вывод дописала. Так действительно понятнее и вычисление процентелей теперь иллюстрируются.
</div>

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

Спасибо!
</div>

### Перцентили стоимости заказов


```python
# посчитаем 95-й и 99-й перцентили стоимости заказов
print(np.percentile(orders['revenue'], [95, 99]))
```

    [28000.  58233.2]


***
***Вывод:*** *Не более 5% покупок в интренет-магазине совершается со стоимостью более 28000 рублей и не более 1% покупок более 58233.2 рублей. Выберем 58000 границей для определения аномальных заказов.*
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Принято!
</div>

### Различия в среднем количестве заказов на посетителя по сырым данным



Посчитаем статистическую значимость различий в среднем количестве заказов на посетителя между группами по «сырым» данным. 
Сформулируем гипотезы. 
Нулевая: различий в среднем количестве заказов между группами нет. 
Альтернативная: различия в среднем между группами есть.

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Гипотезы корректны!
</div>


```python
# Определим посетителей для каждой группы
visitorsPerDateA = visitors.query('group= = "A"')
visitorsPerDateB = visitors.query('group= = "B"')
```

<div class="alert alert-warning">
    <b>⚠️ Комментарий ревьюера:</b>
    
Построение таблицы data в целом не требуется. Из этой таблицы берется только количество посетителей, которое можно взять напрямую из visitors.
</div>

<div class="alert alert-info">
Замениала код. так проще и понятнее )
</div>

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

Супер!
</div>

Создадим переменные ordersByUsersA и ordersByUsersB со столбцами ['visitor_id', 'orders']. В них для пользователей, которые заказывали хотя бы 1 раз, укажем число совершённых заказов. 


```python
ordersByUsersA = (
    orders[orders['group'] == 'A']
    .groupby('visitor_id', as_index=False)
    .agg({'transaction_id': pd.Series.nunique})
)
ordersByUsersA.columns = ['visitor_id', 'orders']

ordersByUsersB = (
    orders[orders['group'] == 'B']
    .groupby('visitor_id', as_index=False)
    .agg({'transaction_id': pd.Series.nunique})
)
ordersByUsersB.columns = ['visitor_id', 'orders']
```

Объявим переменные sampleA и sampleB, в которых пользователям из разных групп будет соответствовать количество заказов. Тем, кто ничего не заказал, будут соответствовать нули. 


```python
sampleA = pd.concat(
    [
        ordersByUsersA['orders'],
        pd.Series(
            0,
            index=np.arange(
                visitorsPerDateA['visitors'].sum() - len(ordersByUsersA['orders'])
            ),
            name='orders',
        ),
    ],
    axis=0,
)

sampleB = pd.concat(
    [
        ordersByUsersB['orders'],
        pd.Series(
            0,
            index=np.arange(
                visitorsPerDateB['visitors'].sum() - len(ordersByUsersB['orders'])
            ),
            name='orders',
        ),
    ],
    axis=0,
)
```

Ранее мы наблюдали графическое отображение выбросов в данных. Дополнительно проверим распределения выборок на нормальность, применив критерий Шапиро-Уилка.


```python
# проверим нормальность распределения в среднем количестве заказов на посетителя по сырым данным в группе А
alpha = 0.05  # критический уровень статистической значимости

results = st.shapiro(sampleA)
p_value = results[1]                 

print('p-значение:', p_value)

if p_value < alpha:
    print('Отвергаем нулевую гипотезу: распределение не нормально')
else:
    print('Не получилось отвергнуть нулевую гипотезу, всё нормально') 
```

    p-значение: 0.0
    Отвергаем нулевую гипотезу: распределение не нормально


    /opt/conda/lib/python3.9/site-packages/scipy/stats/_morestats.py:1800: UserWarning: p-value may not be accurate for N > 5000.
      warnings.warn("p-value may not be accurate for N > 5000.")



```python
# проверим нормальность распределения количество заказов по пользователям 
alpha = 0.05  # критический уровень статистической значимости

results = st.shapiro(sampleB)
p_value = results[1]

print('p-значение:', p_value)

if p_value < alpha:
    print('Отвергаем нулевую гипотезу: распределение не нормально')
else:
    print('Не получилось отвергнуть нулевую гипотезу, всё нормально') 
```

    p-значение: 0.0
    Отвергаем нулевую гипотезу: распределение не нормально


<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Молодец что сделала проверку распределения!
</div>

Поскольку в наших данных есть выбросы и они сотоят из двух независимых выборок, применим метод st.mannwhitneyu().
Определим уровень статистической значимости alpha = 0.05


```python
print('Статистическая значимость различий в среднем количестве заказов на посетителя между группами по «сырым» данным:',"{0:.3f}".format(stats.mannwhitneyu(sampleA, sampleB)[1]))
print('Относительный прирост среднего числа заказов группы B к группе А:',"{0:.3f}".format(sampleB.mean() / sampleA.mean() - 1))
```

    Статистическая значимость различий в среднем количестве заказов на посетителя между группами по «сырым» данным: 0.017
    Относительный прирост среднего числа заказов группы B к группе А: 0.138


<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Вычисления корректны!
</div>

<div class="alert alert-warning">
    <b>⚠️ Комментарий ревьюера:</b>
    
Давай подпишем цифры на выходе. Сторонний человек, просматривая твой проект, не поймет что это за цифры и как на основе них ты приняла решение. То же самое нужно сделать и для других проверок.
</div>

<div class="alert alert-info">
Цифрф подписала для всех проверок
</div>

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

Спасибо!
</div>

***
***Вывод:*** *По сырым данным P-value 0,017 значительно меньше alpha. Мы можем отвергнуть нулевую гипотезу - различия в среднем количестве заказов между группами есть. Относительный прирост среднего числа заказов группы B - 13,8%. Посмотрим повлиял ли на этот результат выброс в дальнейших расчетах.*
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Вывод принят!
</div>

### Различия в среднем чеке заказа между группами по «сырым» данным

Посчитаем статистическую значимость различий в среднем чеке заказа между группами по «сырым» данным.
Нулевая гипотеза: различий в среднем чеке между группами нет. Альтернативная гипотеза: различия в среднем чеке между группами есть. И найдём относительные различия в среднем чеке между группами.


```python
print('Cтатистическая значимость различий в среднем чеке заказа между группами по «сырым» данным:','{0:.3f}'.format(stats.mannwhitneyu(orders[orders['group']=='A']['revenue'], orders[orders['group']=='B']['revenue'])[1]))
print('Относительные различия в среднем чеке между группами В и А:','{0:.3f}'.format(orders[orders['group']=='B']['revenue'].mean()/orders[orders['group']=='A']['revenue'].mean()-1)) 
```

    Cтатистическая значимость различий в среднем чеке заказа между группами по «сырым» данным: 0.729
    Относительные различия в среднем чеке между группами В и А: 0.259


***
***Вывод:*** *P-value 0.729 значительно больше 0.05. Значит, причин отвергать нулевую гипотезу и считать, что в среднем чеке есть различия, нет. Впрочем, средний чек группы B  выше среднего чека группы A на 25,9%. Возможно опять причиной тому выбросы в даных.*
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Проверка корректна!
</div>

###  Различия в среднем количестве заказов на посетителя между группами по «очищенным» данным

Сосчитаем статистическую значимость различий в среднем количестве заказов на посетителя между группами по «очищенным» данным. 

Ранее мы выяснили, что не более 5% посетителей интренет-магазина делали более двух заказов и не более 1% посетителей более 4-х заказов. Выберем 4 заказа границей для определения аномальных пользователей.
 Так же не более 5% покупок в интренет-магазине совершается со стоимостью более 28000 рублей и не более 1% покупок более 58233.2 рублей. Выберем 58233.2  границей для определения аномальных заказов.

Сделаем срезы пользователей с числом заказов больше 4 — usersWithManyOrders и пользователей, совершивших заказы дороже 58233.2 — usersWithExpensiveOrders. Объединим их в таблице abnormalUsers. 


```python
usersWithManyOrders = pd.concat(
    [
        ordersByUsersA[ordersByUsersA['orders'] > int(np.percentile(ordersByUsers['orders'], [99]))]['visitor_id'],
        ordersByUsersB[ordersByUsersB['orders'] > int(np.percentile(ordersByUsers['orders'], [99]))]['visitor_id'],
    ],
    axis=0,
)
usersWithExpensiveOrders = orders[orders['revenue'] > int(np.percentile(orders['revenue'], [99]))]['visitor_id']
abnormalUsers = (
    pd.concat([usersWithManyOrders, usersWithExpensiveOrders], axis=0)
    .drop_duplicates()
    .sort_values()
)
print('Количетво пользователей, совершивших более 4 покупок или потративших сумму более 58233.2 рублей:',abnormalUsers.shape[0])
```

    Количетво пользователей, совершивших более 4 покупок или потративших сумму более 58233.2 рублей: 15


<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Молодец что используешь код перцентилей!
</div>

Мы получили 14 аномальнх пользователей. Проверим, какую роль сыграли эти аномали в тесте. Посчитаем статистическую значимость различий в среднем количестве заказов между группами теста по очищенным данным. Сначала подготовим выборки количества заказов по пользователям по группам теста.


```python
sampleAFiltered = pd.concat(
    [
        ordersByUsersA[
            np.logical_not(ordersByUsersA['visitor_id'].isin(abnormalUsers))
        ]['orders'],
        pd.Series(
            0,
            index=np.arange(
                visitorsPerDateA['visitors'].sum() - len(ordersByUsersA['orders'])
            ),
            name='orders',
        ),
    ],
    axis=0,
)

sampleBFiltered = pd.concat(
    [
        ordersByUsersB[
            np.logical_not(ordersByUsersB['visitor_id'].isin(abnormalUsers))
        ]['orders'],
        pd.Series(
            0,
            index=np.arange(
                visitorsPerDateB['visitors'].sum() - len(ordersByUsersB['orders'])
            ),
            name='orders',
        ),
    ],
    axis=0,
)
```

Применим статистический критерий Манна-Уитни к полученным выборкам. alpha = 0.05. Нулевая гипотеза: различий в среднем количестве заказов между группами нет. Альтернативная: различия в среднем между группами есть.


```python
print('Cтатистическая значимость различий в среднем количестве заказов на посетителя между группами по «очищенным» данным:''{0:.3f}'.format(stats.mannwhitneyu(sampleAFiltered, sampleBFiltered)[1]))
print('Относительный прирост среднего числа заказов группы B к А:','{0:.3f}'.format(sampleBFiltered.mean()/sampleAFiltered.mean()-1)) 
```

    Cтатистическая значимость различий в среднем количестве заказов на посетителя между группами по «очищенным» данным:0.014
    Относительный прирост среднего числа заказов группы B к А: 0.153


***
***Вывод:*** *По очищенным от выбросов данным P-value 0,014 также как и по сырым значительно меньше 0.05. Мы и тут можем отвергнуть нулевую гипотезу - различия в среднем между группами есть. Относительный прирост среднего числа заказов группы B увеличолось  - 15,3%.*
***

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера:</b>

Принято!
</div>

### Различия в среднем чеке заказа между группами по «очищенным» данным.

Посчитаем статистическую значимость различий в среднем чеке заказа между группами по «очищенным» данным. 
Н0: различий в среднем чеке между группами нет. 
Н1: различия в среднем чеке между группами есть. 


```python
print('Cтатистическая значимость различий в среднем чеке заказа между группами по «очищенным» данным:',
    '{0:.3f}'.format(
        stats.mannwhitneyu(
            orders[
                np.logical_and(
                    orders['group'] == 'A',
                    np.logical_not(orders['visitor_id'].isin(abnormalUsers)),
                )
            ]['revenue'],
            orders[
                np.logical_and(
                    orders['group'] == 'B',
                    np.logical_not(orders['visitor_id'].isin(abnormalUsers)),
                )
            ]['revenue'],
        )[1]
    )
)

print('Относительные различия в среднем чеке между группами В и А:',
    "{0:.3f}".format(
        orders[
            np.logical_and(
                orders['group'] == 'B',
                np.logical_not(orders['visitor_id'].isin(abnormalUsers)),
            )
        ]['revenue'].mean()
        / orders[
            np.logical_and(
                orders['group'] == 'A',
                np.logical_not(orders['visitor_id'].isin(abnormalUsers)),
            )
        ]['revenue'].mean()
        - 1
    )
) 
```

    Cтатистическая значимость различий в среднем чеке заказа между группами по «очищенным» данным: 0.851
    Относительные различия в среднем чеке между группами В и А: -0.006


***
***Вывод:*** *P-value 0,851 как и раньше больше 0.05. Значит, причин отвергать нулевую гипотезу и считать, что в среднем чеке есть различия, нет. Вто же время, средний чек группы B стал ниже, чем у группы А на 0,6%. Удаление выбросов весомо поняло картину в среднем чеке.*
***

<div class="alert alert-danger">
    <b>❌ Комментарий ревьюера:</b>
    
Не совсем верно: `Вто же время, средний чек группы B стал ниже, чем у группы А на 0,006%` - значение `-0.006` соответствует 0.6%. Поправь, пожалуйста.
</div>

<div class="alert alert-info">
Поправила
</div>

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

Принято!
</div>

## Вывод

***
***В нашем распоряжении были данные с результатами проведенного А/В тестов крупного интернет - магазина.***

*По итогу нашего исследования методами ICE RICE мы определили две приоритетные гипотезы по увеличению выручки интернет-магазина:*

***1.***  *Добавить форму подписки на все основные страницы, чтобы собрать базу клиентов для email-рассылок*

***2.***  *Добавить два новых канала привлечения трафика, что позволит привлекать на 30% больше пользователей*
    
***Мы исследовали данные и нашли в них некоторые особенности:***

* *Тест проходил 30 дней. С 1 по 31 августа 2019 года*

* *Различие количества пользователей составляют не более, чем 1%.*

* *Обнаружили пользователей, которые попали в обе группы, их количество составляет 5,6% от общего числа уникальных пользователей. Решили оставить исходные данные, так как не сможем удалить этих пользователей из двух датафреймов.*

***Проанализировали результаты A/B-теста:***

*  *Различия в среднем количестве заказов между группами есть. По сырым данным P-value 0,017 , по очищенным - 0,014. Оба показателя значительно меньше alpha 0,05. Относительный прирост среднего числа заказов группы B увеличилось - 15,3% по сырым данным и 13,8%.*


* *Различия в среднем чеке не обнаружилось. По сырым данным P-value 0.729, по очищенным - 0,851. Оба параметра значительно больше 0.05. Средний чек группы B по сырым данным был выше среднего чека группы A на 25,9%. А по очищенным -  средний чек группы B стал даже ниже, чем у группы А на 0,6%. Удаление выбросов в данных весомо поняло картину в среднем чеке.*


* *По итогам принимаем решение остановить тест. Группа В победила - количество продаж увеличилось, а значит и выручка возрасла.Это подтверждает и график куммулятивной выручки.*

***

<div class="alert alert-danger">
    <b>❌ Комментарий ревьюера:</b>
    
В целом, вывод корректный, но здесь также нужно поправить значение 0,006% на 0.6%: `средний чек группы B стал даже ниже, чем у группы А на 0,006%`
</div>

<div class="alert alert-info">
Исправила
</div>

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

Принято!
</div>

<div class="alert alert-success">
    <b>✅ Комментарий ревьюера V2:</b>

Проект принят! 🎉
    
Успехов в дальнейшем обучении!
</div>


```python

```
